<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > ul > li:nth-child(4) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > ul > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > ul > li:nth-child(4) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>DC V/I Sensing | Atinverter Docs</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="DC V/I Sensing" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A comprehensive documentation detailing how to use the Atinverter" /> <meta property="og:description" content="A comprehensive documentation detailing how to use the Atinverter" /> <link rel="canonical" href="http://localhost:4000/software/library/features/dc_vi_sensing_feature.html" /> <meta property="og:url" content="http://localhost:4000/software/library/features/dc_vi_sensing_feature.html" /> <meta property="og:site_name" content="Atinverter Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="DC V/I Sensing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A comprehensive documentation detailing how to use the Atinverter","headline":"DC V/I Sensing","url":"http://localhost:4000/software/library/features/dc_vi_sensing_feature.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Atinverter Docs </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/vision.html" class="nav-list-link">Vision</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Hardware category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hardware/hardware.html" class="nav-list-link">Hardware</a><ul class="nav-list"><li class="nav-list-item"><a href="/hardware/a_v1_hw.html" class="nav-list-link">Atinverter V1 Hardware</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Atinverter V2 Hardware category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hardware/atinverter_v2/a_v2_hw.html" class="nav-list-link">Atinverter V2 Hardware</a><ul class="nav-list"><li class="nav-list-item"><a href="/hardware/atinverter_v2/ov_reset_prot_hw.html" class="nav-list-link">OV and Reset Protection</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/buck_conv_hw.html" class="nav-list-link">Buck Converter</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/power_inverter_hw.html" class="nav-list-link">Power Inverter</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/boost_conv_hw.html" class="nav-list-link">Boost Converter</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/LED_blinking_hw.html" class="nav-list-link">LED Blinking</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/dc_volt_sensing_hw.html" class="nav-list-link">DC Voltage Sensing</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/ac_volt_sensing_hw.html" class="nav-list-link">AC Voltage Sensing</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/ac_curr_sensing_hw.html" class="nav-list-link">AC Current Sensing</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/inter_board_comms.html" class="nav-list-link">Inter-Board Communication</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/dc_curr_sensing_hw.html" class="nav-list-link">DC Current Sensing</a></li><li class="nav-list-item"><a href="/hardware/atinverter_v2/experimentation.html" class="nav-list-link">Experimentation</a></li></ul></li><li class="nav-list-item"><a href="/hardware/ST_HW.html" class="nav-list-link">St. Thomas Inverter Specs</a></li><li class="nav-list-item"><a href="/hardware/power_rating.html" class="nav-list-link">Atinverter V1/2 Power Rating</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Software category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/software.html" class="nav-list-link">Software</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/a_v1_sw.html" class="nav-list-link">Atinverter V1 Software</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Atinverter V2 Software category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/a_v2_sw.html" class="nav-list-link">Atinverter V2 Software</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Library category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/library/library.html" class="nav-list-link">Library</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/library/library_reference.html" class="nav-list-link">Reference</a></li><li class="nav-list-item"><a href="/software/library/library_setup.html" class="nav-list-link">Set Up</a></li><li class="nav-list-item"><a href="/software/library/library_uml.html" class="nav-list-link">UML Diagram</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Features category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/library/features/library_features.html" class="nav-list-link">Features</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/library/features/blink_feature.html" class="nav-list-link">Blink</a></li><li class="nav-list-item"><a href="/software/library/features/dc_vi_sensing_feature.html" class="nav-list-link">DC V/I Sensing</a></li><li class="nav-list-item"><a href="/software/library/features/ac_vi_sensing_feature.html" class="nav-list-link">AC V/I Sensing</a></li><li class="nav-list-item"><a href="/software/library/features/pwm_inversion_feature.html" class="nav-list-link">PWM Inversion</a></li><li class="nav-list-item"><a href="/software/library/features/timer2_delay_feature.html" class="nav-list-link">Timer 2 Delay</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Modules category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/modules/modules.html" class="nav-list-link">Modules</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/modules/blink_module.html" class="nav-list-link">Blink</a></li><li class="nav-list-item"><a href="/software/modules/main_module.html" class="nav-list-link">Main</a></li><li class="nav-list-item"><a href="/software/modules/pwm_inversion_module.html" class="nav-list-link">PWM Inversion</a></li><li class="nav-list-item"><a href="/software/modules/dc_vi_sensing_module.html" class="nav-list-link">DC V/I Sensing</a></li><li class="nav-list-item"><a href="/software/modules/ac_vi_sensing_module.html" class="nav-list-link">AC V/I Sensing</a></li></ul></li></ul></li></ul></li><li class="nav-list-item"><a href="/scratchpad.html" class="nav-list-link">Scratchpad</a></li><li class="nav-list-item"><a href="/todo.html" class="nav-list-link">To-Do</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Atinverter Docs" aria-label="Search Atinverter Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/just-the-docs/just-the-docs-template" class="site-button" > Template Repository </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/software/software.html">Software</a></li> <li class="breadcrumb-nav-list-item"><a href="/software/a_v2_sw.html">Atinverter V2 Software</a></li> <li class="breadcrumb-nav-list-item"><a href="/software/library/library.html">Library</a></li> <li class="breadcrumb-nav-list-item"><a href="/software/library/features/library_features.html">Features</a></li> <li class="breadcrumb-nav-list-item"><span>DC V/I Sensing</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <!-- To enable math equation formatting --> <p><!-- Polyfill for older browsers (optional) --> <script type="text/javascript" async="" src="https://polyfill.io/v3/polyfill.min.js?features=es6"> </script></p> <p><!-- MathJax v3 for LaTeX rendering --> <script type="text/javascript" async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script></p> <p><!-- Custom MathJax Configuration --> <script type="text/javascript"> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], } }; </script></p> <h1 id="dc-vi-sensing-library-feature"> <a href="#dc-vi-sensing-library-feature" class="anchor-heading" aria-labelledby="dc-vi-sensing-library-feature"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>DC V/I Sensing Library Feature</strong> </h1> <hr /> <h2 id="-overview"> <a href="#-overview" class="anchor-heading" aria-labelledby="-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìã Overview </h2> <p>The DC Voltage and Current Sensing feature provides an interface for monitoring the input voltage and current of the PWM inverter. It utilizes the onboard ADC pins of the ATMEGA328P, along with TMCS1108A4BQDR Hall-effect current sensor. Voltage is measured through a resistive voltage divider, while current is measured using the analog output of the current sensor. These signals can be obtained through methods which use raw readouts of the ADC or for improved accuracy, through a running average sampling method. <br /> <br /></p><hr /> <h2 id="-pin-assignments"> <a href="#-pin-assignments" class="anchor-heading" aria-labelledby="-pin-assignments"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìå Pin Assignments </h2> <p><br /></p> <div style="text-align: left;"> <h7> <b>Table X.</b> ATMEGA328P Pin Configuration for DC Sensing </h7> </div> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Pin Description</th> <th style="text-align: center">Pin Name (Code)</th> <th style="text-align: center">Pin Number</th> <th style="text-align: center">Pin State</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">DC Voltage Sensing</td> <td style="text-align: center">V_DC_PIN</td> <td style="text-align: center">A0</td> <td style="text-align: center">INPUT</td> </tr> <tr> <td style="text-align: center">DC Current Sensing</td> <td style="text-align: center">I_DC_PIN</td> <td style="text-align: center">A1</td> <td style="text-align: center">INPUT</td> </tr> </tbody> </table></div> <p><br /></p><hr /> <h2 id="-header-file-definitions"> <a href="#-header-file-definitions" class="anchor-heading" aria-labelledby="-header-file-definitions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìÇ Header File Definitions </h2> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.h</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// TMCS1108 Current Sensor Parameters</span>
<span class="cp">#define SENSOR_GAIN_MV_PER_A 400.0f
#define MV_TO_V 1000.0f
#define VOUT_0A 2.5f
</span>
<span class="c1">// ADC Parameters</span>
<span class="cp">#define VREF 5.0f
#define ADC_ATMEGA328P_MAX_VALUE 1023.0f
</span>
<span class="c1">// Moving Average Samples</span>
<span class="cp">#define MA_SAMPLES 10
</span>
<span class="c1">// DC Voltage and Current Pin Definitions</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">V_DC_PIN</span> <span class="o">=</span> <span class="n">A0</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">I_DC_PIN</span> <span class="o">=</span> <span class="n">A1</span><span class="p">;</span>

<span class="c1">// DC Voltage Sensing Resistor Values</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">Rvs1</span> <span class="o">=</span> <span class="mi">120000</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">Rsv2</span> <span class="o">=</span> <span class="mi">9900</span><span class="p">;</span>

<span class="c1">// Parameters for Vdc Moving Average</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Vdc_num_readings</span> <span class="o">=</span> <span class="n">MA_SAMPLES</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">Vdc_readings</span><span class="p">[</span><span class="n">MA_SAMPLES</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">Vdc_read_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">Vdc_total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Parameters for Idc Moving Average</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Idc_num_readings</span> <span class="o">=</span> <span class="n">MA_SAMPLES</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">Idc_readings</span><span class="p">[</span><span class="n">MA_SAMPLES</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">Idc_read_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">Idc_total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Method Declarations</span>
<span class="kt">float</span> <span class="nf">getVdc</span><span class="p">();</span>
<span class="kt">float</span> <span class="nf">getIdc</span><span class="p">();</span>
<span class="kt">float</span> <span class="nf">getAvgDC</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isVdc</span><span class="p">,</span> <span class="kt">float</span> <span class="n">signalValue</span><span class="p">);</span>
</code></pre></div></div> <p><br /></p><hr /> <h2 id="-method-descriptions"> <a href="#-method-descriptions" class="anchor-heading" aria-labelledby="-method-descriptions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìù Method Descriptions </h2> <h2 id="getvdc"> <a href="#getvdc" class="anchor-heading" aria-labelledby="getvdc"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">getVdc()</code> </h2> <p><strong>Purpose:</strong> Senses and returns the input DC voltage.</p> <p><strong>Pseudocode:</strong></p> <ol> <li>Read raw ADC value from ATMEGA328P analog pin connected to sensing voltage</li> <li>Translate the digital ADC reading into its analog voltage equivalent <ul> <li> \[Sensed\ Voltage = \left( \frac{Reference\ Voltage \times ADC\ Reading}{2^{(ADC\ Bits)} - 1} \right)\] </li> </ul> </li> <li>Convert the sensed voltage to the DC input voltage using rearranged voltage divider <ul> <li> \[Input\ DC\ Voltage = Sensed\ Voltage \times \frac{(Top\ Resistor + Bottom\ Resistor)}{Top\ Resistor}\] </li> </ul> </li> <li>Return the calculated DC input voltage</li> </ol> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.cpp</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">getVdc</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">digital_val</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">V_DC_PIN</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">Vdc_sense</span> <span class="o">=</span> <span class="p">(</span><span class="n">VREF</span> <span class="o">*</span> <span class="n">digital_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ADC_ATMEGA328P_MAX_VALUE</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">Vdc</span> <span class="o">=</span> <span class="n">Vdc_sense</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rvs1</span> <span class="o">+</span> <span class="n">Rsv2</span><span class="p">)</span> <span class="o">/</span> <span class="n">Rsv2</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">Vdc</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p><br /></p> <h2 id="getidc"> <a href="#getidc" class="anchor-heading" aria-labelledby="getidc"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">getIdc()</code> </h2> <p><strong>Purpose:</strong> Senses and returns the input DC current.</p> <p><strong>Pseudocode:</strong></p> <ol> <li>Read raw ADC value from ATMEGA328P analog pin connected to TMCS1108 analog output</li> <li>Translate the digital ADC reading into its analog voltage equivalent <ul> <li> \[Output\ Voltage = \left( \frac{Reference\ Voltage \times ADC\ Reading}{2^{(ADC\ Bits)} - 1} \right)\] </li> </ul> </li> <li>Compute the input current using the transfer function from the TMCS1108 datasheet<br /> (equation 1 on page 12) <ul> <li> \[Input\ DC\ Current = \left( \frac{Output\ Voltage - Zero\ Current\ Output\ Voltage}{Sensitivity} \right)\] </li> </ul> </li> <li>Return the calculated DC input current</li> </ol> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.cpp</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">getIdc</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">digital_val</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">I_DC_PIN</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">Vout</span> <span class="o">=</span> <span class="p">(</span><span class="n">VREF</span> <span class="o">*</span> <span class="n">digital_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ADC_ATMEGA328P_MAX_VALUE</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">Idc</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vout</span> <span class="o">-</span> <span class="n">VOUT_0A</span><span class="p">)</span> <span class="o">/</span> <span class="n">SENSOR_GAIN_MV_PER_A</span> <span class="o">*</span> <span class="n">MV_TO_V</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">Idc</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p><br /></p> <h2 id="getavgdcbool-isvdc-float-signalvalue"> <a href="#getavgdcbool-isvdc-float-signalvalue" class="anchor-heading" aria-labelledby="getavgdcbool-isvdc-float-signalvalue"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">getAvgDC(bool isVdc, float signalValue)</code> </h2> <p><strong>Purpose:</strong> Computes and returns the moving average for the input DC voltage or current based on a pre-defined sample count.</p> <p><strong>Pseudocode:</strong></p> <ol> <li>Decide which sampling array will be utilized based on user input</li> <li>Store the most recent value received in the buffer</li> <li>Add the readings to the running total</li> <li>Increment the sampling array index</li> <li>Check if read index is above the buffer size <ul> <li>If yes, reset buffer index</li> <li>If no, continue</li> </ul> </li> <li>Compute the average signal using total over the number of readings</li> <li>Substract the oldest reading to prepare for new readng</li> <li>Return the averaged signal</li> </ol> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.cpp</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">getAvgDC</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isVdc</span><span class="p">,</span> <span class="kt">float</span> <span class="n">signalValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">num_readings</span> <span class="o">=</span> <span class="n">isVdc</span> <span class="o">?</span> <span class="n">Vdc_num_readings</span> <span class="o">:</span> <span class="n">Idc_num_readings</span><span class="p">;</span>
  <span class="kt">float</span><span class="o">*</span> <span class="n">readings</span> <span class="o">=</span> <span class="n">isVdc</span> <span class="o">?</span> <span class="n">Vdc_readings</span> <span class="o">:</span> <span class="n">Idc_readings</span><span class="p">;</span>
  <span class="kt">int</span><span class="o">&amp;</span> <span class="n">read_index</span> <span class="o">=</span> <span class="n">isVdc</span> <span class="o">?</span> <span class="n">Vdc_read_index</span> <span class="o">:</span> <span class="n">Idc_read_index</span><span class="p">;</span>
  <span class="kt">float</span><span class="o">&amp;</span> <span class="n">total</span> <span class="o">=</span> <span class="n">isVdc</span> <span class="o">?</span> <span class="n">Vdc_total</span> <span class="o">:</span> <span class="n">Idc_total</span><span class="p">;</span>

  <span class="n">readings</span><span class="p">[</span><span class="n">read_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">signalValue</span><span class="p">;</span>
  <span class="n">total</span> <span class="o">+=</span> <span class="n">readings</span><span class="p">[</span><span class="n">read_index</span><span class="p">];</span>

  <span class="n">read_index</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">read_index</span> <span class="o">&gt;=</span> <span class="n">num_readings</span><span class="p">){</span>
    <span class="n">read_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span> 

  <span class="kt">float</span> <span class="n">avg_signal</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">num_readings</span><span class="p">;</span>
  <span class="n">total</span> <span class="o">-=</span> <span class="n">readings</span><span class="p">[</span><span class="n">read_index</span><span class="p">];</span>

  <span class="k">return</span> <span class="n">avg_signal</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
