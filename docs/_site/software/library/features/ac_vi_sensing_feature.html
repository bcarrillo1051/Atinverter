<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > ul > li:not(:nth-child(3)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > ul > li:nth-child(4) > ul > li:nth-child(3) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > ul > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > ul > li:nth-child(1) > ul > li:nth-child(4) > ul > li:nth-child(3) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>AC V/I Sensing | Atinverter Docs</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="AC V/I Sensing" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A comprehensive documentation detailing how to use the Atinverter" /> <meta property="og:description" content="A comprehensive documentation detailing how to use the Atinverter" /> <link rel="canonical" href="http://localhost:4000/software/library/features/ac_vi_sensing_feature.html" /> <meta property="og:url" content="http://localhost:4000/software/library/features/ac_vi_sensing_feature.html" /> <meta property="og:site_name" content="Atinverter Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="AC V/I Sensing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A comprehensive documentation detailing how to use the Atinverter","headline":"AC V/I Sensing","url":"http://localhost:4000/software/library/features/ac_vi_sensing_feature.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Atinverter Docs </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/vision.html" class="nav-list-link">Vision</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Hardware category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hardware/hardware.html" class="nav-list-link">Hardware</a><ul class="nav-list"><li class="nav-list-item"><a href="/hardware/a_v1_hw.html" class="nav-list-link">Atinverter V1 Hardware</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Atinverter V2 Hardware category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hardware/a_v2_hw.html" class="nav-list-link">Atinverter V2 Hardware</a><ul class="nav-list"><li class="nav-list-item"><a href="/hardware/buck_conv.html" class="nav-list-link">Buck Converter</a></li><li class="nav-list-item"><a href="/hardware/boost_conv.html" class="nav-list-link">Boost Converter</a></li></ul></li><li class="nav-list-item"><a href="/hardware/ST_HW.html" class="nav-list-link">St. Thomas Inverter Specs</a></li><li class="nav-list-item"><a href="/hardware/power_rating.html" class="nav-list-link">Atinverter V1/2 Power Rating</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Software category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/software.html" class="nav-list-link">Software</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/a_v1_sw.html" class="nav-list-link">Atinverter V1 Software</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Atinverter V2 Software category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/a_v2_sw.html" class="nav-list-link">Atinverter V2 Software</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Library category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/library/library.html" class="nav-list-link">Library</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/library/library_reference.html" class="nav-list-link">Reference</a></li><li class="nav-list-item"><a href="/software/library/library_setup.html" class="nav-list-link">Set Up</a></li><li class="nav-list-item"><a href="/software/library/library_uml.html" class="nav-list-link">UML Diagram</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Features category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/library/features/library_features.html" class="nav-list-link">Features</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/library/features/blink_feature.html" class="nav-list-link">Blink</a></li><li class="nav-list-item"><a href="/software/library/features/dc_vi_sensing_feature.html" class="nav-list-link">DC V/I Sensing</a></li><li class="nav-list-item"><a href="/software/library/features/ac_vi_sensing_feature.html" class="nav-list-link">AC V/I Sensing</a></li><li class="nav-list-item"><a href="/software/library/features/pwm_inversion_feature.html" class="nav-list-link">PWM Inversion</a></li><li class="nav-list-item"><a href="/software/library/features/timer2_delay_feature.html" class="nav-list-link">Timer 2 Delay</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Modules category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/modules/modules.html" class="nav-list-link">Modules</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/modules/blink_program.html" class="nav-list-link">Blink</a></li><li class="nav-list-item"><a href="/software/modules/main_program.html" class="nav-list-link">Main</a></li><li class="nav-list-item"><a href="/software/modules/pwm_inversion_program.html" class="nav-list-link">PWM Inversion</a></li><li class="nav-list-item"><a href="/software/modules/dc_vi_sensing_program.html" class="nav-list-link">DC V/I Sensing</a></li><li class="nav-list-item"><a href="/software/modules/ac_vi_sensing_program.html" class="nav-list-link">AC V/I Sensing</a></li></ul></li></ul></li></ul></li><li class="nav-list-item"><a href="/scratchpad.html" class="nav-list-link">Scratchpad</a></li><li class="nav-list-item"><a href="/todo.html" class="nav-list-link">To-Do</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Atinverter Docs" aria-label="Search Atinverter Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/just-the-docs/just-the-docs-template" class="site-button" > Template Repository </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/software/software.html">Software</a></li> <li class="breadcrumb-nav-list-item"><a href="/software/a_v2_sw.html">Atinverter V2 Software</a></li> <li class="breadcrumb-nav-list-item"><a href="/software/library/library.html">Library</a></li> <li class="breadcrumb-nav-list-item"><a href="/software/library/features/library_features.html">Features</a></li> <li class="breadcrumb-nav-list-item"><span>AC V/I Sensing</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <!-- To enable math equation formatting --> <p><!-- Polyfill for older browsers (optional) --> <script type="text/javascript" async="" src="https://polyfill.io/v3/polyfill.min.js?features=es6"> </script></p> <p><!-- MathJax v3 for LaTeX rendering --> <script type="text/javascript" async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script></p> <p><!-- Custom MathJax Configuration --> <script type="text/javascript"> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], } }; </script></p> <h1 id="ac-vi-sensing-library-feature"> <a href="#ac-vi-sensing-library-feature" class="anchor-heading" aria-labelledby="ac-vi-sensing-library-feature"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>AC V/I Sensing Library Feature</strong> </h1> <hr /> <h2 id="-overview"> <a href="#-overview" class="anchor-heading" aria-labelledby="-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìã Overview </h2> <p>The AC Voltage and Current Sensing feature enables real-time monitoring of the PWM inverter‚Äôs output voltage and current. It leverages the ATMEGA328P‚Äôs SPI peripheral to interface with the ADC122S021 which samples conditioned analog signals. This feature includes methods for configuring the SPI bus, acquiring ADC readings, correcting DC offset, computing RMS values, and setting the sensitivity factor that scales the AC RMS readings.</p> <p>As mentioned in the <a href="../../hardware/a_v2_hw">AC Voltage Sensing</a> hardware section, to achieve AC RMS voltage measurement across the load of the power inverter ($V_{\mathrm{AC_load}}$), the signal is:</p> <ol> <li>Transformed from a 12V-48$V_{pk}$ AC signal to a composite signal containing both DC and AC components.</li> <li>Scaled down to a 2.5V DC, 0-1V AC peak signal (effectively ranges from 1.5V to 3.5V), to maintain compatibility with the ADC122S021 input channels</li> </ol> <p>Now that this signal is conditioned appropriately for sampling, the next step is properly configure the SPI bus on the ATMEGA328P to interface with the ADC122S021. <br /> <br /></p><hr /> <h2 id="-outline-of-spi-communication"> <a href="#-outline-of-spi-communication" class="anchor-heading" aria-labelledby="-outline-of-spi-communication"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üîÑ Outline of SPI Communication </h2> <p>The ATMEGA328P operates as the master/controller and the ADC122S021 as the slave/peripheral. As it is conventional in SPI communication, the ATMEGA328P initiates communication by setting <strong>CS</strong> low. The communication is conducted in 16 clock pulses of the <strong>SCLK</strong> frequency, corresponding to two byte data frames.</p> <p>Since SPI inherently is <strong>full-duplex</strong>, these two data frames are used for:</p> <ol> <li>Sending control data through MOSI (<strong>DIN of ADC122S021</strong>) to specify the channel to read from</li> <li>Receiving conversion data through MISO (<strong>DOUT of ADC122S021</strong>)</li> </ol> <p>It should be highlighted that the only useful data for <strong>DIN</strong> and <strong>DOUT</strong> are the first 8 most significant bits (MSB) and the last 12 least significant bits (LSB) respectively.</p> <p>The ADC122S021 uses a successive approximation register (SAR) topology with a track-and-hold mechanism. The voltage samples are tracked for the first 4 clock cycles and held for data transmission during the subsequent 12 clock cycles.</p> <p>Once the 12-bit conversion data is received by the ATMEGA328P, the CS line is enabled high to terminate communication with the ADC122S021.</p> <p>The timing diagram of the ADC122S021 provides an insightful visual representation of the SPI communication and reflects the information covered.</p> <p><img src="../../../images/ADC122S021_timing_diagram.png" alt="ADC122S021 Operational Timing Diagram" /></p> <p><br /></p><hr /> <h2 id="-choosing-the-appropriate-spi-clock-source"> <a href="#-choosing-the-appropriate-spi-clock-source" class="anchor-heading" aria-labelledby="-choosing-the-appropriate-spi-clock-source"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ‚åö Choosing the Appropriate SPI Clock Source </h2> <p>Ensuring suitable communication with the ADC122S021 relies on providing a clock source from the ATMEGA328P that falls within the allowable frequency range of the device. The clock signal is critical as it maps to the sampling rate of the ADC122S021 which is also constrained to a specific range. The table below summarizes the ranges of allowable clock frequencies and their corresponding sample rates:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Notation</th> <th style="text-align: center">Parameter</th> <th style="text-align: center">Range</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">$f_{sclk}$</td> <td style="text-align: center">Clock Frequency</td> <td style="text-align: center">0.8MHz - 3.2MHz</td> </tr> <tr> <td style="text-align: center">$f_{s}$</td> <td style="text-align: center">Sample Rate</td> <td style="text-align: center">50ksps - 200ksps</td> </tr> </tbody> </table></div> <p>The relationship between the sample rate and the clock frequency can be understood from the following equation:</p> \[f_{s} = \frac{f_{SCLK}}{16}\] <p>This expression reflects the idea that a complete 12-bit signal conversion requires 16 clock pulses. As a result, the sampling frequency is one-sixteenth of the clock frequency.</p> <p>The clock source delivered to the ADC122S021 is derived from the 16MHz main clock of the ATMEGA328P and a pre-scaler value of our choosing. The available pre-scalers are displayed below:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Prescaler</th> <th style="text-align: center">Arduino Command</th> <th style="text-align: center">Resulting Frequency</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">2</td> <td style="text-align: center">SPI_CLOCK_DIV2</td> <td style="text-align: center">8 MHz</td> </tr> <tr> <td style="text-align: center">4</td> <td style="text-align: center">SPI_CLOCK_DIV4</td> <td style="text-align: center">4 MHz</td> </tr> <tr> <td style="text-align: center">8</td> <td style="text-align: center">SPI_CLOCK_DIV8</td> <td style="text-align: center">2 MHz</td> </tr> <tr> <td style="text-align: center">16</td> <td style="text-align: center">SPI_CLOCK_DIV16</td> <td style="text-align: center">1 MHz</td> </tr> <tr> <td style="text-align: center">32</td> <td style="text-align: center">SPI_CLOCK_DIV32</td> <td style="text-align: center">500 kHz</td> </tr> <tr> <td style="text-align: center">64</td> <td style="text-align: center">SPI_CLOCK_DIV64</td> <td style="text-align: center">250 kHz</td> </tr> <tr> <td style="text-align: center">128</td> <td style="text-align: center">SPI_CLOCK_DIV128</td> <td style="text-align: center">125 kHz</td> </tr> </tbody> </table></div> <p>Given that the clock signal is constrained to the range of 0.8MHz - 3.2MHz for the ADC122S021, this means we can choose to either to supply a 1MHz or 2MHz clock signal from the ATMEGA328P. Either option is in theoretically valid, but there are important tradeoffs to consider:</p> <p>Choosing a higher sampling frequency (2MHz):</p> <ul> <li>Better resolution</li> <li>Improved signal to noise ratio (SNR)</li> <li>Spreading of ADC quantization noise over a broader bandwidth</li> </ul> <p>Choosing a lower sampling frequency (1MHz):</p> <ul> <li>Reduced software overhead (fewer clock cycles)</li> <li>Less memory intensive for MCU</li> <li>More power efficient</li> </ul> <p>The <strong>Nyquist Sampling Theorem</strong> states that to minimally reconstruct an analog signal without aliasing, the sampling frequency $f_{s}$ must be at least 2 times the maximum frequency component $f_{max}$ of the analog signal. This miminum requirement for the sampling rate is also known as the Nyquist Rate.</p> \[f_{s} \geq 2 \times f_{max}\] <p>Aliasing represents an adverse effect where the sampled waveform loses its charateristic shape and appears as a different frequency.</p> <p>While just marginally satisfying the Nyquist Rate condition may be appropriate in some applications, this does not always guarentee proper resolution and amplitude accuracy of the signal.</p> <p>In practical applications such as sampling sinusoidal signals, it is recommended that $f_{s}$ is at least 5 to 10 times the sinusoidal signal $f_{sinusoid}$.</p> <p align="center"> <img src="../../../images/ADC_sampling_rate_sinusoid.png" alt="ADC Sampling Rate Effects" width="600" /> </p> <p>Higher ADC sample rates yield finer resolution in the digitized sinusoidal waveform, whereas lower sampling raters result in a degraded signal in terms of resolution and signal shape.</p> <p>In this design, the ADC122S021 is tasked with sampling the output voltage and current signals of PWM inverter, both of which are 50Hz or 60Hz sinusoidal signals depending on the PWM generation technique. Considering how these signals are far lower in frequency relative to the sampling capabilities of the ADC122S021, a clock rate of 1MHz (pre-scaler 16) was selected. This aims to reduce software overhead and memory load as well as maintain an adequate sampling rate for proper signal digitization.</p> \[f_{s} = \frac{1 \times 10^6Hz}{16} = 62.5kHz\] \[\frac{f_{s}}{f_{max}} = \frac{62.5 \times 10^3Hz}{60Hz} ‚âà 1042\] <p>The sampling frequeny is substantially larger than the recommended amount so a high fidelity signal is to be expected.</p> <p>Translating this concept into software, the command below:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">CLOCK_FREQUENCY</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
</code></pre></div></div> <p>is used to specify key metrics of the SPI communication protocol. The <code class="language-plaintext highlighter-rouge">CLOCK_FREQUENCY</code> is a macro that maps to 1MHz. In addition, most significant bit (MSB) transmission and SPI Mode 0 (CPOL = 0, CPHA = 0) are specified with macros in accordance with ADC122S021 device requirements. <br /></p><hr /> <h2 id="-pin-assignments"> <a href="#-pin-assignments" class="anchor-heading" aria-labelledby="-pin-assignments"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìå Pin Assignments </h2> <p>The following table delineates the pins used for the SPI protocol and their desired states:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Pin Type</th> <th style="text-align: center">Digital Pin Number</th> <th style="text-align: center">State</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">CS</td> <td style="text-align: center">10</td> <td style="text-align: center">OUTPUT</td> </tr> <tr> <td style="text-align: center">MOSI</td> <td style="text-align: center">11</td> <td style="text-align: center">OUTPUT</td> </tr> <tr> <td style="text-align: center">MISO</td> <td style="text-align: center">12</td> <td style="text-align: center">INPUT</td> </tr> <tr> <td style="text-align: center">SCLK</td> <td style="text-align: center">13</td> <td style="text-align: center">OUTPUT</td> </tr> </tbody> </table></div> <p>Configuring all SPI pins on the ATMEGA328P can be performed by using <code class="language-plaintext highlighter-rouge">SPI.begin()</code> from the Arduino built-in <code class="language-plaintext highlighter-rouge">SPI.h</code> library. Since the <code class="language-plaintext highlighter-rouge">SPI.h</code> library is included in the user-defined header file <code class="language-plaintext highlighter-rouge">Atinverter.h</code>, no need to include it separately in the module program.</p> <p><br /></p><hr /> <h2 id="-library-structure"> <a href="#-library-structure" class="anchor-heading" aria-labelledby="-library-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìÇ Library Structure </h2> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.h</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;SPI.h&gt;</span><span class="cp">
</span>
<span class="c1">// TMCS1108 Current Sensor Parameters</span>
<span class="cp">#define SENSOR_GAIN_MV_PER_A 400.0f
#define MV_TO_V 1000.0f
#define VOUT_0A 2.5f
</span>
<span class="c1">// ADC Parameters</span>
<span class="cp">#define VREF 5.0f
#define ADC_122S021_MAX_VALUE 4095.0f
</span>
<span class="c1">// Parameters AC Sensing</span>
<span class="kt">uint32_t</span> <span class="n">period</span><span class="p">;</span>
<span class="kt">float</span> 	 <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">DEFAULT_SENSITIVITY</span><span class="p">;</span>

<span class="c1">// AC Voltage and Current Pin Definitions</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">VI_AC_CS_PIN</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">VI_AC_MOSI_PIN</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">VI_AC_MISO_PIN</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">VI_AC_SCLK_PIN</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>

<span class="c1">// Methods</span>
<span class="kt">void</span> <span class="nf">setUpSPI</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">setSensitivity</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getADC</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">control_byte</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getZeroPoint</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">control_byte</span><span class="p">);</span>
<span class="kt">float</span> <span class="nf">getRmsAC</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">loopCount</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isVac</span><span class="p">);</span>
</code></pre></div></div> <p><br /></p><hr /> <h2 id="-method-descriptions"> <a href="#-method-descriptions" class="anchor-heading" aria-labelledby="-method-descriptions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üìù Method Descriptions </h2> <h2 id="void-setupspi"> <a href="#void-setupspi" class="anchor-heading" aria-labelledby="void-setupspi"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">void setUpSPI()</code> </h2> <p><strong>Purpose:</strong> Initializes the SPI interface and configures the relevant pins.</p> <p><strong>Pseudocode:</strong></p> <ol> <li>Configure CS, MOSI, and SCLK pins to their desired state</li> </ol> <p><code class="language-plaintext highlighter-rouge">Atinverter.cpp</code> Code:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">setUpSPI</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div> <p><br /></p> <h2 id="int-getzeropointuint8_t-control_byte"> <a href="#int-getzeropointuint8_t-control_byte" class="anchor-heading" aria-labelledby="int-getzeropointuint8_t-control_byte"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">int getZeroPoint(uint8_t control_byte)</code> </h2> <p><strong>Purpose:</strong> Calculates the zero-point (DC offset) value of the ADC readings over a full sampling period. This value is used to remove the DC bias from the AC signal before performing RMS calculations.</p> <p><strong>Parameters:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">control_byte</code> ‚Äì ADC command byte: <code class="language-plaintext highlighter-rouge">0x00</code> selects channel 1; <code class="language-plaintext highlighter-rouge">0x08</code> selects channel 2</li> </ul> <p><strong>Pseudocode:</strong></p> <ol> <li>Initialize accumulators and timing</li> <li>While the elapsed time is less than the period: <ul> <li>Read the ADC value from the specified control_byte channel</li> <li>Accumulate the ADC value</li> <li>Increment the measurement count</li> </ul> </li> <li>Return <ul> <li>Compute and return the average (sum divided by the count)</li> </ul> </li> </ol> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.cpp</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">getZeroPoint</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">control_byte</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">Vsum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">measurements_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">t_start</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">millis2</span><span class="p">();</span>

	<span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">millis2</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_start</span> <span class="o">&lt;</span> <span class="n">period</span><span class="p">)</span>
	<span class="p">{</span>
    <span class="n">Vsum</span> <span class="o">+=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getADC</span><span class="p">(</span><span class="n">control_byte</span><span class="p">);</span>
		<span class="n">measurements_count</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">Vsum</span> <span class="o">/</span> <span class="n">measurements_count</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p><br /></p> <h2 id="void-setsensitivityfloat-value"> <a href="#void-setsensitivityfloat-value" class="anchor-heading" aria-labelledby="void-setsensitivityfloat-value"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">void setSensitivity(float value)</code> </h2> <p><strong>Purpose:</strong> Sets the sensitivity factor used to scale RMS ADC values to real-world signal amplitude.</p> <p>The sensitivity factor is applied in the <code class="language-plaintext highlighter-rouge">getRmsAC()</code> method after calculating the RMS value of the ADC samples. It ensures that the returned value reflects the actual physical signal magnitude, not just the ADC voltage level.</p> <p><strong>Pseudocode:</strong></p> <ol> <li>Take the user-defined sensitivity input.</li> <li>Store it as the internal sensitivity scaling variable.</li> </ol> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.cpp</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">setSensitivity</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">sensitivity</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p><br /></p> <h2 id="int-getadcuint8_t-control_byte"> <a href="#int-getadcuint8_t-control_byte" class="anchor-heading" aria-labelledby="int-getadcuint8_t-control_byte"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">int getADC(uint8_t control_byte)</code> </h2> <p><strong>Purpose:</strong> Initiates an SPI transaction with the ADC122S021 to retrieve a 12-bit digital conversion result from the specified input channel.</p> <p><strong>Parameters:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">control_byte</code> ‚Äì ADC command byte: <code class="language-plaintext highlighter-rouge">0x00</code> selects channel 1; <code class="language-plaintext highlighter-rouge">0x08</code> selects channel 2</li> </ul> <p><strong>Pseudocode:</strong></p> <ol> <li>Pull CS low and configure SPI parameters to begin SPI transmission</li> <li>Conduct 1st byte transfer <ul> <li>Send control byte to specify channel</li> <li>Receive 8 MSB conversion bits (only 4 LSB are significant)</li> </ul> </li> <li>Shift first 8 bits received by 8 bits to make that MSB data</li> <li>Conduct a 2nd byte transfer <ul> <li>Send dummy byte (0x00)</li> <li>Receive 8 LSB bits of conversion</li> </ul> </li> <li>Combine the 2 received bytes (MSB + LSB)</li> <li>Mask the lower 12 bits to get valid ADC data</li> <li>Pull CS high to end transaction</li> <li>Return 12-bit ADC sample</li> </ol> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.cpp</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">getADC</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">control_byte</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">VI_AC_CS_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">CLOCK_FREQUENCY</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
  
  <span class="kt">uint16_t</span> <span class="n">data</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">control_byte</span><span class="p">);</span>
  <span class="n">data</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  
  <span class="n">data</span> <span class="o">|=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">VI_AC_CS_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>

  <span class="n">data</span> <span class="o">&amp;=</span> <span class="mh">0x0FFF</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p><br /></p> <h2 id="float-getrmsacuint8_t-loopcount-bool-isvac"> <a href="#float-getrmsacuint8_t-loopcount-bool-isvac" class="anchor-heading" aria-labelledby="float-getrmsacuint8_t-loopcount-bool-isvac"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">float getRmsAC(uint8_t loopCount, bool isVac)</code> </h2> <p><strong>Purpose:</strong> Calculates the RMS value of either AC voltage or current over multiple user-defined sampling cycles. The value is offset-corrected using the zero-point and scaled using a sensitivity factor to reflect the actual signal amplitude.</p> <p><strong>Parameters:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">loopCount</code> ‚Äì number of sampling cycles to average over for increased accuracy</li> <li><code class="language-plaintext highlighter-rouge">isVac</code> ‚Äì <code class="language-plaintext highlighter-rouge">true</code> to measure AC voltage; <code class="language-plaintext highlighter-rouge">false</code> to measure AC current</li> </ul> <p><strong>Pseudocode:</strong></p> <ol> <li>Determine the ADC channel based on <code class="language-plaintext highlighter-rouge">isVac</code> <ul> <li><code class="language-plaintext highlighter-rouge">true</code> to use voltage channel</li> <li><code class="language-plaintext highlighter-rouge">false</code>to use current channel</li> </ul> </li> <li>Iterate <code class="language-plaintext highlighter-rouge">loopCount</code> times: <ul> <li>Compute DC offset using <code class="language-plaintext highlighter-rouge">getZeroPoint()</code></li> <li>Initialize accumulators and timing</li> <li>While elapsed time is less than the period:</li> </ul> <ul> <li>Sample ADC</li> <li>Remove DC offset and square the result</li> <li>Accumulate the sum and measurement count</li> <li>Compute RMS value using the root mean square formula: $X_{RMS} = \sqrt{\frac{1}{N} \sum x^2}$</li> <li>Scale result using <code class="language-plaintext highlighter-rouge">sensitivity</code> to convert to physical units</li> </ul> </li> <li>Average all loop results and return the final RMS value</li> </ol> <p><strong>Implementation in <code class="language-plaintext highlighter-rouge">Atinverter.cpp</code>:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">Atinverter</span><span class="o">::</span><span class="n">getRmsAC</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">loopCount</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isVac</span><span class="p">)</span> <span class="p">{</span>

  <span class="kt">uint8_t</span> <span class="n">control_byte</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">isVac</span><span class="p">){</span>
    <span class="n">control_byte</span> <span class="o">=</span> <span class="n">VAC_ADC_CHANNEL</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">control_byte</span> <span class="o">=</span> <span class="n">IAC_ADC_CHANNEL</span><span class="p">;</span>
  <span class="p">}</span>

	<span class="kt">double</span> <span class="n">readingVoltage</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">f</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loopCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">zeroPoint</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getZeroPoint</span><span class="p">(</span><span class="n">control_byte</span><span class="p">);</span>

		<span class="kt">int32_t</span> <span class="n">Vnow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">uint32_t</span> <span class="n">Vsum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">uint32_t</span> <span class="n">measurements_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">uint32_t</span> <span class="n">t_start</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">millis2</span><span class="p">();</span>

		<span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">millis2</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_start</span> <span class="o">&lt;</span> <span class="n">period</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Vnow</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getADC</span><span class="p">(</span><span class="n">control_byte</span><span class="p">)</span> <span class="o">-</span> <span class="n">zeroPoint</span><span class="p">;</span>
			<span class="n">Vsum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">Vnow</span> <span class="o">*</span> <span class="n">Vnow</span><span class="p">);</span>
			<span class="n">measurements_count</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">readingVoltage</span> <span class="o">+=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">Vsum</span> <span class="o">/</span> <span class="n">measurements_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">ADC_122S021_MAX_VALUE</span> <span class="o">*</span> <span class="n">VREF</span> <span class="o">*</span> <span class="n">sensitivity</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">readingVoltage</span> <span class="o">/</span> <span class="n">loopCount</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
