<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Atinverter V2 Hardware | Atinverter Docs</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="Atinverter V2 Hardware" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A comprehensive documentation detailing how to use the Atinverter" /> <meta property="og:description" content="A comprehensive documentation detailing how to use the Atinverter" /> <link rel="canonical" href="http://localhost:4000/hardware/a_v2_hw.html" /> <meta property="og:url" content="http://localhost:4000/hardware/a_v2_hw.html" /> <meta property="og:site_name" content="Atinverter Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Atinverter V2 Hardware" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A comprehensive documentation detailing how to use the Atinverter","headline":"Atinverter V2 Hardware","url":"http://localhost:4000/hardware/a_v2_hw.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Atinverter Docs </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/vision.html" class="nav-list-link">Vision</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Hardware category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hardware/hardware.html" class="nav-list-link">Hardware</a><ul class="nav-list"><li class="nav-list-item"><a href="/hardware/a_v1_hw.html" class="nav-list-link">Atinverter V1 Hardware</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Atinverter V2 Hardware category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hardware/a_v2_hw.html" class="nav-list-link">Atinverter V2 Hardware</a><ul class="nav-list"><li class="nav-list-item"><a href="/hardware/buck_conv.html" class="nav-list-link">Buck Converter</a></li><li class="nav-list-item"><a href="/hardware/boost_conv.html" class="nav-list-link">Boost Converter</a></li></ul></li><li class="nav-list-item"><a href="/hardware/ST_HW.html" class="nav-list-link">St. Thomas Inverter Specs</a></li><li class="nav-list-item"><a href="/hardware/power_rating.html" class="nav-list-link">Atinverter V1/2 Power Rating</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Software category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/software.html" class="nav-list-link">Software</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Library category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/library/library.html" class="nav-list-link">Library</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/library/library_setup.html" class="nav-list-link">Atinverter Library Set Up</a></li><li class="nav-list-item"><a href="/software/library/library_uml.html" class="nav-list-link">Atinverter UML Diagram</a></li><li class="nav-list-item"><a href="/software/library/timer2_delay.html" class="nav-list-link">Timer 2 Delay</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Modules category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software/modules/modules.html" class="nav-list-link">Modules</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/modules/blink.html" class="nav-list-link">Blink</a></li><li class="nav-list-item"><a href="/software/modules/ac_volt_sensing.html" class="nav-list-link">AC Voltage Sensing</a></li><li class="nav-list-item"><a href="/software/modules/dc_curr_sensing.html" class="nav-list-link">DC Current Sensing</a></li><li class="nav-list-item"><a href="/software/modules/dc_volt_sensing.html" class="nav-list-link">DC Voltage Sensing</a></li><li class="nav-list-item"><a href="/software/modules/main.html" class="nav-list-link">Main</a></li><li class="nav-list-item"><a href="/software/modules/pwm_inverting.html" class="nav-list-link">PWM Inverting</a></li><li class="nav-list-item"><a href="/software/modules/ac_curr_sensing.html" class="nav-list-link">AC Current Sensing</a></li></ul></li></ul></li><li class="nav-list-item"><a href="/scratchpad.html" class="nav-list-link">Scratchpad</a></li><li class="nav-list-item"><a href="/todo.html" class="nav-list-link">To-Do</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Atinverter Docs" aria-label="Search Atinverter Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/just-the-docs/just-the-docs-template" class="site-button" > Template Repository </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/hardware/hardware.html">Hardware</a></li> <li class="breadcrumb-nav-list-item"><span>Atinverter V2 Hardware</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <!-- To enable math equation formatting --> <p><!-- Polyfill for older browsers (optional) --> <script type="text/javascript" async="" src="https://polyfill.io/v3/polyfill.min.js?features=es6"> </script></p> <p><!-- MathJax v3 for LaTeX rendering --> <script type="text/javascript" async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script></p> <p><!-- Custom MathJax Configuration --> <script type="text/javascript"> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], } }; </script></p> <h1 id="atinverter-v2-hardware"> <a href="#atinverter-v2-hardware" class="anchor-heading" aria-labelledby="atinverter-v2-hardware"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Atinverter V2 Hardware</strong> </h1> <hr /> <p>The <strong>Atinverter Version 2 (V2)</strong> incorporates a multitude of subsystems that work in tandem to support the board’s main function as a <strong>power inverter</strong>. A power inverter, not to be confused with a digital logic inverter, is a type of converter that takes a DC signal and transforms it to an AC signal.</p> <blockquote class="highlight-yellow"> <p>💭 “Why Atinverter?”</p> </blockquote> <p>With the aim of highlighting the relationship between the ATMEGA328P MCU and the power inverter circuitry, the name is based on: “ATMEGA328P” + “Inverter” = “Atinverter”</p> <p>To better visualize the core components and the interconnections of the design, consider the following the <strong>high-level block diagram</strong>:</p> <p align="center"> <img src="../images/atinverter_v2_block_diagram.png" alt="Atinverter V2 Block Diagram" width="700" /> </p> <h2 id="systems"> <a href="#systems" class="anchor-heading" aria-labelledby="systems"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Systems</strong> </h2> <p>To better understand the full scope of the Atinverter V2, it’s helpful to explore the following systems in more detail.</p> <ul> <li>🔌 Power Inverter</li> <li>💡 LED Blinking for Bootloader Verification</li> <li>📟 DC Voltage Sensing</li> <li>📟 DC Current Sensing</li> <li>📟 AC Voltage Sensing</li> <li>📟 AC Current Sensing</li> <li>🔁 ATMEGA328P &amp; Raspberry Pi I²C Communication</li> </ul> <p class="highlight-green">🔌 Power Inverter</p> <h3 id="️-pwm-generation"> <a href="#️-pwm-generation" class="anchor-heading" aria-labelledby="️-pwm-generation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 〰️ PWM Generation </h3> <p>The power inverter operation is catalyzed by the <strong>PWM generation</strong> from the <strong>ATMEGA328P</strong>. This MCU generates <strong>pulse-width modulated (PWM) square waves</strong> that, when combined with an appropriate switching circuit and filtering stage, can approximate the output of a <strong>pure sine wave power inverter.</strong></p> <p>While there are other simpler approaches that can be employed to achieve inversion, such as square wave or modified square wave inverters, this one achieves <strong>higher levels of waveform fidelity</strong>. In other words, this modulation technique allows our output waveform to behave and appear more like a <strong>real sine wave.</strong></p> <p><img src="../images/different_inverter_waveforms.jpg" alt="Different Types of AC Waveforms Produced by Inverters" /> Source: <a href="https://www.e-education.psu.edu/eme812/node/711">Different Types of AC signals Produced by Inverters</a></p> <h3 id="-gate-drivers"> <a href="#-gate-drivers" class="anchor-heading" aria-labelledby="-gate-drivers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🧠 Gate Drivers </h3> <p>The next stage in the power signal chain is the gate driver circuit. It performs two main tasks:</p> <ol> <li>Effectively level shifts the low voltage PWM signals from the ATMEGA328P into higher voltages required by the H-bridge circuit.</li> <li>Enhance the current delivery to the power transistors to swiftly charge and discharge the gate capacitance of the transistors to ensure rapid switching of the devices.</li> </ol> <h3 id="-h-bridge-topology"> <a href="#-h-bridge-topology" class="anchor-heading" aria-labelledby="-h-bridge-topology"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔁 H-Bridge Topology </h3> <p>Being composed of <strong>4 power transistors</strong> that complimentarily <strong>switch at a specific frequency</strong>, the H-bridge topology is a conventional design that is widely implemented in many pure sine wave inverters. This design <strong>enables the connected load to experience a positive and negative voltage swing</strong> solely based on switching states, effectively eliminating the need for a negative supply rail. This dual-polarity effect is what allows for the production of a full AC swing across the load and is achieved by PWM control signals as well as only one DC supply.</p> <h3 id="-lc-filter"> <a href="#-lc-filter" class="anchor-heading" aria-labelledby="-lc-filter"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔉 LC Filter </h3> <p>Prior to the delivering the power to the load, a low pass filter stage is employed to:</p> <ol> <li>Remove high frequency content, especially the switching frequency of the PWM signals.</li> <li>Preserve the fundamental frequency of interest. In our case, our PWM-based inverter is designed for 50 or 60Hz.</li> </ol> <h3 id="-power-inverter-summary"> <a href="#-power-inverter-summary" class="anchor-heading" aria-labelledby="-power-inverter-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🧩 Power Inverter Summary </h3> <p>After providing an overview of each of the power inverter stages, from PWM generation to filtering, consider the diagram below illustrating the signal chain:</p> <p align="center"> <img src="../images/PWM_generation.png" alt="PWM Generation" width="700" /> </p> <p>To clarify subtle details about the diagram, DP5 and DP6 represent the digital pins 5 and 6 respectively. Also, two gate drivers were implemented into the design since each controls one pair of transistors.</p> <p class="highlight-green">💡 LED Blinking for Bootloader Verification</p> <p>The LED circuit is effectively <strong>four LEDs</strong> that are independently controlled using <strong>four different GPIO pins</strong> of the ATMEGA328P.</p> <p>These LEDs are cycled on and off using a blink program providing a trivial aesthetic effect, but its primary purpose is a <strong>functional verfication</strong> of ATMEGA328P. Using a visual indictator allows us to determine if the MCU is bootloaded, which is a necessary step when working with a <strong>brand-new chip</strong>.</p> <p align="center"> <img src="../images/LED_bootload_circuit.png" alt="LED Bootload Circuit" width="350" /> </p> <p class="highlight-green">📟 DC Voltage Sensing</p> <p>Voltage sensing of the DC input ($V_{DC}$) is achieved through a simple resistive divider. The resistive divider is made up of a limiting current resistor ($R_{limit}$) paired with a sensing resistor ($R_{sense}$). The voltage across the sensing resistance is measured by an ATMEGA328P analog pin which senses a voltage in the range of 0-5V ($V_{sense}$). It should be noted that the ATMEGA328P I/O pins cannot exceed 5V, as doing so may result in permanent damage to the MCU.</p> <p align="center"> <img src="../images/DC_voltage_sensing.png" alt="DC Voltage Sensing" width="250" /> </p> <p>Resistors values are chosen based on this condition as well as drawing an insignificant amount of power from the DC input, since the current in this path is to be delivered primarily to the output load.</p> <p>The resistor values of $R_{limit} = 120k\Omega$ and $R_{sense} = 10k\Omega$ were chosen based on the standard voltage divider equation:</p> \[V_{sense} = V_{DC} \times \left( \frac{R_{sense}}{R_{sense}\times R_{limit}} \right)\] <p>Given that the nominal DC input range is 12V to 48V, this translates to a sensed voltage as low as 0.92V and a high as 3.69V. It is evident that the full scale range of the analog pin is not used (0-5V), but this is intentional to account for potential overvoltage driving at the DC pin. Nonetheless, the 10 bit analog to digital converter (ADC) of the ATMEGA328P works as necessary in detecting the DC voltage based on the design parameters selected.</p> <p class="highlight-green">📟 DC Current Sensing</p> <p>The current in the DC input line is measured using a Hall-effect current sensor. Let’s briefly cover how this type of device operates.</p> <h3 id="hall-effect-current-sensor-overview"> <a href="#hall-effect-current-sensor-overview" class="anchor-heading" aria-labelledby="hall-effect-current-sensor-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hall-Effect Current Sensor Overview </h3> <p>To understand hall-effect current sensors, we need to consider two fundamental laws of electromagnetism:</p> <ol> <li>Lorentz Force Law</li> <li>Ampere’s Law</li> </ol> <p>Rather than just explaining what the laws mean, let’s understand how they manifest themselves in the operation of the device.</p> <p>Consider a conductive element where a current flows. The yellow balls represent electrons that are evenly distributed when flowing through a conductor. The current flow is denoted as “I”.</p> <p align="center"> <img src="../images/hall_effect_1.png" alt="Hall Effect 1" width="250" /> </p> <p>Ampere’s law tells us that a magnetic field is generated around the conductor in accordance with the right-hand rule and that magnetic field is proportional to the current that is flowing. Additionally, if an external magnetic field is applied near the conductor (strongest when perpendicular due to Lorentz force), the electrons will be deflected and accumulate in one area leaving the opposite side with a net positive charge. The charge separation between both ends can be measured — known as the hall-voltage.</p> <p align="center"> <img src="../images/hall_effect_2.png" alt="Hall Effect 2" width="250" /> </p> <h3 id="tmcs1108"> <a href="#tmcs1108" class="anchor-heading" aria-labelledby="tmcs1108"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TMCS1108 </h3> <p>In this design, the <strong>TMCS1108 current sensor</strong> detects the magnetic field generated by the DC input current. It internally measures the hall-voltage and then amplifies it to produce an <strong>analog voltage output which is proportional to the sensed current</strong>. This analog voltage can be calculated using the <a href="https://www.ti.com/lit/ds/symlink/tmcs1108.pdf?HQS=dis-dk-null-digikeymode-dsf-pf-null-wwe&amp;ts=1744785799224">TMCS1108 datasheet</a> provided equation in page 12:</p> \[V_{OUT} = S \times I_{IN} + V_{OUT,0A}\] <p>where:</p> <ul> <li>$V_{OUT}$ is the analog output voltage.</li> <li>S is the ideal sensitivity of the device.</li> <li>$I_{IN}$ is the isolated input current.</li> <li>$V_{OUT,0A}$ is the zero current output voltage for the device variant.</li> </ul> <p>As this design employs the <strong>TMCS1108A4BQDR</strong> device variant, this features a sensitivity is 400mV/A. This describes the relation between the output analog voltage and current input where the output changes 400mV for every 1A of detected current. Higher sensitivities are generally favorable, as they results in a greater voltage response per unit of current.</p> <p>The non-zero current output is due to the device bidirectionality of the sensor, where the output is centered at mid-supply as noted in page 3 of the <a href="https://www.ti.com/lit/ds/symlink/tmcs1108.pdf?HQS=dis-dk-null-digikeymode-dsf-pf-null-wwe&amp;ts=1744785799224">TMCS1108 datasheet</a>.</p> \[V_{OUT,0A} = 0.5 × V_{S}\] <p>where:</p> <ul> <li>$V_{OUT,0A}$ is the zero current output voltage for the device variant.</li> <li>$V_{S}$ is the supply voltage to the chip.</li> </ul> <p>Since the chip is powered by a 5V supply, at no current input, the output analog voltage resides at 2.5V. For positive current, the output voltage increases above 2.5V and conversesly for negative current, the output decreases below 2.5V.</p> <p>The analog output voltage is then measured by the analog pin of our ATMEGA328P, where it is converted to a digital value between the range of 0-1023. After the MCU has an understanding of what the voltage signal is in the digital domain, the current for the DC input is computed using a restructured form of the previous equation.</p> \[I_{IN} = \frac{V_{OUT} - V_{OUT,0A}}{S}\] <p>This conversion ultimately produces an accurate current reading based on the previously discussed hall-effect phenomenon and fulfills the goal of measuring the DC input current of the Atinverter V2 device.</p> <p class="highlight-green">📟 AC Voltage Sensing</p> <p>To achieve the sensing of the AC voltage at the output of the power inverter, the approach is more involved than the DC voltage sensing methodology described earlier. Not only does a step down mechanism need to be implemented to provide a low power sensed signal to a processing device, but also a method to handle or correct for the the bipolar nature of the AC wave, namely the negative swing. More specifically, the AC voltage sensing network needs to be able to scale a 12V-48Vpk signal to 0-5V signal in order to be compatible with the ADC122S021, which is used for output voltage and current sampling. The ADC122S021 serves as the intermediary between the ATMEGA328P and the AC sensed signal. It samples the output produced by the AC voltage sensing network and transmits the data to the ATMEGA328P via SPI communication. The ATMEGA328P receives the sensed data by requesting channel 1 of the ADC122S021 and uses it to compute the RMS reading of the voltage.</p> <p align="center"> <img src="../images/AC_voltage_sensing_block_diagram.png" alt="AC Voltage Sensing Network" width="600" /> </p> <p>This section covers the hardware implementation for the AC sensing framework as illustrated above, but to learn more about how the RMS computation is performed and the software that orchestrates the sensing computation, see the section <strong>“BLAH”</strong>.</p> <h2 id="ac-voltage-sensing-network"> <a href="#ac-voltage-sensing-network" class="anchor-heading" aria-labelledby="ac-voltage-sensing-network"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>AC Voltage Sensing Network</strong> </h2> <p align="center"> <img src="../images/AC_voltage_sensing_network.png" alt="AC Voltage Sensing Network" width="800" /> </p> <p>The design is comprised of two main stages:</p> <ol> <li><strong>ZMPT101B Transformer</strong> <ul> <li>Voltage step-down using 1:1 isolation transformer</li> <li>Well known and documented for projects that interface with Arduino/ESP/RaspberryPi devices</li> </ul> </li> <li><strong>Signal Conditioning and Amplification</strong> <ul> <li>A cascaded pair of inverting op-amp configurations to amplify the low-voltage sensed signal</li> <li>Tunable gain set by a potentiometer that aims to reduce potential saturation or improve resolution at AC sensing output</li> <li>Active low-pass filter attenuates high frequecy noise and improve signal integrity</li> </ul> </li> </ol> <h3 id="zmpt101b-transformer"> <a href="#zmpt101b-transformer" class="anchor-heading" aria-labelledby="zmpt101b-transformer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ZMPT101B Transformer </h3> <p>The first stage is based on the ZMPT101B current transformer. It is a 1:1, 1000V, 2mA rated transformer. For a more thorough documentation of the component, please review the <a href="https://5nrorwxhmqqijik.leadongcdn.com/attachment/kjilKBmoioSRqlkqjoipSR7ww7fgzb73m/ZMPT101B-specification.pdf">ZMPT101B datasheet</a>.</p> <p>The input to output voltage relation describing the transformer operation is stated in <strong><em>Figure II</em></strong>:</p> \[U_{2} = \frac{U_{1}}{R'} \times R\] <p>where:</p> <ul> <li>$U_1$ is the input voltage</li> <li>$U_2$ is the output voltage</li> <li>$R’$ is the current limiting resistor</li> <li>$R$ is the voltage sampling resistor</li> </ul> <p>In efforts to maintain consistency with the previous AC Voltage Circuit diagram, we will denote $U_1$, $U_2$, $R’$, $R$ as $V_{\mathrm{AC_in}}$, $V_{\mathrm{AC_samp}}$, $R_{lim}$, $R_{samp}$ respectively. Therefore, the newly denoted equation is</p> \[V_{\mathrm{AC_samp}} = \frac{V_{\mathrm{AC_in}}}{R_{lim}} \times R_{samp}\] <h3 id="-calculating-r_lim"> <a href="#-calculating-r_lim" class="anchor-heading" aria-labelledby="-calculating-r_lim"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔢 Calculating $R_{lim}$ </h3> <p>To achieve higher levels of Signal-to-Noise Ratio (SNR), better ADC range, and noise immunity, a current limiting resistor $R_{lim}$ should be selected such that the magnitude is near the rated current but not exceeding. Choosing a current limiting resistor is based on the highest expected voltage that will be delivered to the input primary side of the transformer. Recalling that the maximum peak voltage for the power inverter is 48V, and considering that the transformer has a rated current of 2mA, a max current value of 1.5mA is chosen. This ensures that $V_{\mathrm{AC_in}}$ is maximized in signal strength to improve resolution, but also provides buffer from operating the part at rated conditions.</p> \[R_{lim} = \frac{V_{\mathrm{AC_in}}}{I_{\mathrm{AC_in}}}\] \[R_{lim} = \frac{48V}{1.5mA} = 32k\Omega\] <ul> <li>Choose $33k\Omega$ based on standard resistor values</li> </ul> <h3 id="-calculating-r_samp"> <a href="#-calculating-r_samp" class="anchor-heading" aria-labelledby="-calculating-r_samp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔢 Calculating $R_{samp}$ </h3> <p>The sampling resistance linearly influences the transformer AC voltage output as per the equation in <strong><em>Figure II</em></strong>. By rearragning the ZMPT101B expression, this renders the following equation usable for solving the sampling resistor in a passive configuration where no amplication is present.</p> \[V_{\mathrm{AC_samp}} = \frac{V_{\mathrm{AC_in}}}{R_{lim}} \times R_{samp}\] \[R_{samp} = \frac{V_{\mathrm{AC_samp}}}{V_{\mathrm{AC_in}}} \times R_{lim}\] <p>However, this expression is not directly applicable since it makes use of an active configuration. Nonetheless, it can be adapted to suit the needs of the current design as detailed in the next section.</p> <h3 id="signal-conditioning-and-amplification"> <a href="#signal-conditioning-and-amplification" class="anchor-heading" aria-labelledby="signal-conditioning-and-amplification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Signal Conditioning and Amplification </h3> <p>The second stage of the <strong>AC Voltage Sensing Network</strong> is a combination of two inverting amplication phases that serve the purpose of amplifying the low voltage signal produced across the sampling resistor. Each level provides an amplication factor of 10, yielding a net gain of 100. To develop a transfer function that accounts for this two op-amp amplification chain in the AC voltage sensing network, this gain stage can be modeled by a variable $G_{amp}$. This net gain is also equivalent to the product of the two intermediate gains $G_{1} \times G_{2}$.</p> <p>The AC voltage from output to input then can be described as:</p> \[V_{\mathrm{ACsense}} = G_{amp} \times \frac{V_{\mathrm{AC_in}}}{R_{lim}} \times R_{samp}\] <p>It is important to note that $V_{\mathrm{ACsense}}$ refers to the desired AC magnitude that will be provided to the ADC122S021 after the two op amp chain whereas $V_{\mathrm{ACsamp}}$ is the AC magnitude at the secondary of the transformer.</p> <p>The amplification phases are also designed to attenuate high frequency noise, as they are based on the active low pass filter topology. This is necessary because although the output of the transformer is being amplified in two segments, the noise present at the op-amp inputs can also amplified. It is beneficial to have this embedded into the design since $V_{\mathrm{ACsense}}$ needs to be a clean waveform for accurate readings from the ADC122S021.</p> <p>The cutoff frequency of this 1st order low-pass filter can be calculated using the following formula:</p> \[f_{c} = \frac{1}{2\pi \times C_{lp} \times R_{fb}}\] <p>Another key feature of the AC Voltage Sensing Network is the potentiometer, $R_{tune}$ as it also impacts the magnitude of $V_{\mathrm{ACsense}}$. Since the potentiometer functions as a voltage divider, it can be modeled by introducing two resistors: $R_{tune1}$, the resistor in series with the signal path, and $R_{tune2}$, the resistor connected to ground. Therefore, the divider ratio is:</p> \[G_{tune} = \frac{R_{tune1}}{R_{tune1}+ R_{tune2}}\] <p>Since the divider ratio is effectively a gain constant between the first and second op amp chain, both of which are linearly combined, the specific placement of this term has no effect on the $V_{\mathrm{ACsense}}$ computation.</p> \[V_{\mathrm{ACsense}} = G_{amp} \times \frac{V_{\mathrm{AC_in}}}{R_{lim}} \times R_{samp} \times G_{tune}\] <p>To obtain the final sampling resistor equation that, we can isolate for the sampling resistor:</p> \[R_{samp} = \frac{V_{\mathrm{ACsense}}}{V_{\mathrm{AC_in}} \times G_{amp} \times G_{tune}} \times R_{lim}\] <p>The AC portion of the $V_{\mathrm{ACsense}}$ signal must remain within the saturation limits of the LM358 op-amp due to resulting amplified signal being centered around a 2.5V DC offset, which is caused by the $R_{bias}$ resistors.</p> <p>Since the LM358 op amp saturates at about 1.5V from the supply voltage (i.e. 5V - 1.5V = 3.5V), then the maximum permissible swing is $V_{\mathrm{ACsense}} = 1V_{pk}$.</p> <p>The worst case scenario for potential saturation occurs when the potentiometer provides no gain attenuation (i.e $G_{tune} = 1$), resulting in an amplification of $G_{amp}$ = 100 applied to $V_{\mathrm{ACsamp}}$. Using this case to calculate the sampling resistor is performed for both ends of the inverter range.</p> <p><strong>\(V_{\mathrm{AC_in}}\) = 12V:</strong></p> \[R_{samp} = \frac{1}{12 \times 100 \times 1} \times 33k = 27.5\Omega\] <p><strong>\(V_{\mathrm{AC_in}}\) = 48V:</strong></p> \[R_{samp} = \frac{1}{48 \times 100 \times 1} \times 33k = 6.87\Omega\] <ul> <li>Choose $6.8\Omega$ based on standard resistor values, as this accomodates for both 12V and 48V $V_{\mathrm{AC_in}}$. The effective resolution of the sensed signal can then be improved by reducing $R_{tune}$, as this increases the output swing without exceeding the op-amp’s output swing range.</li> </ul> <h3 id="simulation"> <a href="#simulation" class="anchor-heading" aria-labelledby="simulation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Simulation </h3> <p>The AC voltage sensing topology was simulated using LTSpice to verify operation. Since the LM358 is not an available in the component library, the OP07 amplifier was used as a suitable substitute.</p> <p align="center"> <img src="../images/AC_voltage_sensor_network_simulation.png" alt="AC Voltage Sensing Network Simulation" width="800" /> </p> <p align="center"> <img src="../images/AC_voltage_sensor_network_simulation_plot.png" alt="AC Voltage Sensing Network Simulation Plot " width="800" /> </p> <p class="highlight-green">📟 AC Current Sensing</p> <p class="highlight-green">🔁 ATMEGA328P &amp; Raspberry Pi I2C Communication</p> <hr> <h2 class="text-delta">Table of contents</h2> <ul> <li> <a href="/hardware/buck_conv.html">Buck Converter</a> </li> <li> <a href="/hardware/boost_conv.html">Boost Converter</a> </li> </ul> </main> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
